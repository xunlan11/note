\documentclass[
12pt, % 字体大小
a4paper, 
oneside, % 单面打印（双面为twoside）
headinclude,footinclude, % 页眉页脚包含在文本区域内，确保不被裁剪或掩盖
]{scrartcl}
\input{../structure.tex} 
\hyphenation{Fortran hy-phen-ation} % 单词断字规则
%----------------------------------------------------------------------------------------
% 题目和作者
\title{\normalfont\spacedallcaps{智能工程}} 
\date{}
%----------------------------------------------------------------------------------------
% 开始和目录
\begin{document}
\maketitle
\newpage
\hypertarget{toc}{}
\begingroup
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\endgroup
\newpage
\begingroup
\begin{multicols}{2}
\listoffigures
\end{multicols}
\endgroup
\hrule
\begingroup
\begin{multicols}{2}
\listoftables
\end{multicols}
\endgroup
\newpage
\listoftips
\newpage
%----------------------------------------------------------------------------------------
\section{基础知识}
%------------------------------------------------
\paragraph{课程内容}
\begin{figure}[H]
\centering
\subfloat[课程内容]{\includegraphics[width=.45\textwidth]{control}} \quad
\subfloat[工作流程]{\includegraphics[width=.45\textwidth]{workflow}}
\caption{课程内容}
\end{figure}

\begin{table}[H]
\centering
\begin{tabular}{|p{0.5cm}|p{2cm}|p{2cm}|p{2cm}|p{2cm}|p{2cm}|p{2cm}|p{2cm}|}
\hline
& $ u_i $ & $ u_o $ & $ R $ & $ F $ & $ u_r $ & $ e $ & $ C $ \\
\hline
概念 & 系统输入 & 系统输出 & 系统模型 & 反馈单元 & 系统给定 & 系统误差 & 控制器 \\
\hline
含义 & 对被控对象施加作用的手段 & 作业目标的可测系统状态 & 系统输入输出映射 & 系统输出映射变换 & 系统作业目标 & 作业目标与系统当前测量状态差值 & 系统误差与输入映射 \\
\hline
内容 & \multicolumn{3}{c|}{机器人运动学} & \multicolumn{2}{c|}{机器人控制} & 机器人感知 & 机器人轨迹规划 \\
\hline
\end{tabular}
\caption{课程内容}
\end{table}
%------------------------------------------------
\paragraph{课程案例}\label{sec:two_wheel}
移动机器人->轮式机器人->两轮差速机器人。

\noindent
\begin{minipage}{0.3\textwidth}
\begin{figure}[H]
\centering
\includegraphics[width=0.6\linewidth]{two_wheel} 
\caption{两轮差速机器人模型}
\end{figure}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{itemize}
\item 车轮半径$ r $。
\item 两轮转速$ \varphi_l,\varphi_r $：$ v_i = r\varphi_i $。
\item 车轮到两轮中间点距离$ l $。
\end{itemize}
\end{minipage}
\begin{minipage}{0.3\textwidth}
\begin{enumerate}
\item 求正运动学模型\ref{sec:example1}。
\item 设计运动控制器\ref{sec:motion_control}。
\item 里程计模型\ref{sec:odometer}。
\end{enumerate}
\end{minipage}
%------------------------------------------------
\section{机器人运动形态（不考）}
%------------------------------------------------
\subsection[移动机器人]{移动机器人}
%------------------------------------------------
\noindent
\begin{minipage}{0.4\textwidth}
\paragraph{自然界运动形态特点}
\begin{itemize}
\item 能量利用率高。
\item 适应野外复杂环境。
\item 与身体尺寸、结构相适应。
\item 运行速度高。
\end{itemize}
\end{minipage}
\begin{minipage}{0.6\textwidth}
\paragraph{机器人实现自然界运动形态问题}
\begin{itemize}
\item 机械结构、能量密度、感知与控制决策能力困难。
\item 安全性、可靠性差。
\item 成本高。
\item 于人造环境低效。
\end{itemize}
\end{minipage}
%------------------------------------------------
\paragraph{运动（Locomoion）}
机器人与环境的物理交互方式。
\begin{itemize}
\item 稳定性。
\item 接触特性。
\item 环境特性。
\end{itemize}
%------------------------------------------------
\subsection[腿式机器人]{腿式机器人}
%------------------------------------------------
\subsubsection[腿式机器人]{腿式机器人}
%------------------------------------------------
\paragraph{研究意义}
\begin{itemize}
\item 复杂恶劣环境的高适应性。
\item 点接触的高通过能力。
\item 控制多自由度、实时感知环境的高实现难度。
\end{itemize}
%------------------------------------------------
\paragraph{腿数影响}
\begin{itemize}
\item 机构复杂度。
\item 控制复杂度。
\item 环境适应性：腿越多，通过性越好，环境适应性越强。
\item 系统稳定性：腿数增加，由动态稳定向静态稳定过度。
\begin{itemize}
\item 动态稳定：执行器停止工作摔倒。运动过程中通常半数腿离地。
\item 静态稳定：执行器停止工作不摔倒。点接触需保证三腿同时着地，面接触需保证一条腿着地。
\end{itemize}
\end{itemize}
%------------------------------------------------
\paragraph{运动规划}
运动学+动力学。
%------------------------------------------------
\paragraph{步态}
一个行进周期内各腿抬落组合，$ k $腿机器人的步态模式数量为$ N = (2^k - 1)! $。
%------------------------------------------------
\paragraph{单位距离能耗}
$ COT = \frac{\text{消耗能量}}{\text{重量} \times \text{运行距离}} $。
%------------------------------------------------
\subsubsection[四足机器人]{四足机器人}
\begin{itemize}
\item 点接触：每条腿至少需要两个自由度，执行器较少，没有冗余。
\item 行走（静态平衡）：一次移动一条腿，剩下腿支持身体，重心落在支持多边形内。适合攀爬，速度低，能效低。
\item 奔跑（动态平衡）：一次移动多条腿，平衡建立在周期运动上。速度高，能效高，需要实时控制与执行。
\end{itemize}
%------------------------------------------------
\subsubsection[双足机器人]{双足机器人}
%------------------------------------------------
\paragraph{两种方案}
\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
方案 & 国家 & 基础方式 & 重心 & 速度 & 环境适应性 & 能效 \\
\hline
静态稳定 & 日本 & 面接触 & 左右变换 & 低 & 差 & 低 \\
\hline
动态稳定 & 美国 & 点接触 & 适时调整 & 高 & 强 & 高 \\
\hline
\end{tabular}
\caption{双足机器人方案对比}
\end{table}
%------------------------------------------------
\paragraph{动态稳定运动机理}
\begin{itemize}
\item 倒立摆模型：类似纯滚动，步距越小越趋于圆。步态不自然，重心变化（需做功），落地冲击大。
\item 无源动态行走：摆动与向前摔落结合，势能转化为动能。
\item 弹簧负载倒立摆（SLIP）：仿照动物腿肌肉，增加弹簧缓冲并储存能量。周期往复运动对称，动态稳定性可由庞加莱变换线性化后验证，条件为$ \lambda < 1 $（PPT.2.34-43）。
\item 串联弹性驱动（SEA）：更为高效，更符合生物自然属性，基于运动学的位置控制，基于动力学的力矩控制。可由其获得稳定平台（PPT.2.48-50）。
\end{itemize}
%------------------------------------------------
\subsection[轮式机器人]{轮式机器人}
%------------------------------------------------
\paragraph{研究意义}
\begin{itemize}
\item 人造环境下高效：滚动摩擦，无重心起伏。
\item 结构简单，可靠性高，成本低。
\item 控制简单，系统复杂度低。
\end{itemize}
%------------------------------------------------
\paragraph{轮数对稳定性的影响}
轮数增加，由动态稳定向静态稳定过度。
\begin{itemize}
\item 动态稳定：执行器停止工作摔倒。倒立摆模型。    
\item 静态稳定：执行器停止工作不摔倒。陀螺效应，随动轮效应。
\end{itemize}
%----------------------------------------------------------------------------------------
\section{机器人运动学}
%------------------------------------------------
\subsection[运动学模型]{运动学模型}
表征机器人驱动（输入）和机器人空间位姿（输出）的关系。
%------------------------------------------------
\paragraph{机械臂与移动机器人在运动学模型上的区别}
\begin{itemize}
\item 机械臂本体坐标系固定，精度高；移动机器人本体坐标系随动，精度低。
\item 非完整约束\tip{非完整约束}：移动机器人只知道码盘变化量无法获取位姿，状态取决于路径。这来源于不可积的微分约束（车轮侧向滑动约束）。
\item 微分运动学（Differential Kinematics）：速度空间替代位置空间。
\end{itemize}
%------------------------------------------------
\subsection[车轮]{车轮}
%------------------------------------------------
\paragraph{类型}\tip{车轮类型}
\begin{figure}[H]
\centering 
\includegraphics[width=0.6\textwidth]{tire} 
\caption{车轮类型}
\end{figure}

\begin{table}[H]
\centering
\begin{tabular}{|p{2cm}|p{4.2cm}|p{2.2cm}|p{7cm}|}
\hline
类型 & 自由度 & 约束 & 分类/特点 \\
\hline
标准轮 \newline （Standard wheel） & $ 2 $ \newline 沿轮平面滚动 \newline 沿垂直轴转动 & $ 1 $ \newline 沿轮轴滑动 & 标准固定轮（无法旋转，只有一个自由度） \newline 标准转向轮（舵轮） \\
\hline
脚轮 \newline （Castor wheel） & $ 3 $ \newline 沿轮平面滚动 \newline 沿垂直轴转动 \newline 沿路轴运动 & $ 0 $ & 偏心距 $ d $：触地点到垂直旋转轴距离。扭矩压力，易损坏。 \\
\hline
瑞典轮 \newline （Swedish wheel） & $ 3 $ \newline 沿轮平面滚动（被动） \newline 沿轮轴转动（主动） \newline 沿垂直轴转动（被动） & $ 0 $ & 麦克纳姆轮（Macanum wheel）：$ 45° $，至少需要$ 4 $个共同使用。 \newline 连续切换轮：$ 90° $，至少需要$ 3 $个共同使用。 \newline 对地面冲击大，噪音大，易损坏，成本高。 \\
\hline
球轮 \newline （Spherical wheel） & $ 3 $（全主动） \newline 沿两个正交轮轴转动 \newline 沿垂直轴转动 & $ 0 $ & 成本高，可靠性差。 \\
\hline
\end{tabular}
\caption{车轮类型对比}
\end{table}
%------------------------------------------------
\paragraph{选取}
\begin{itemize}
\item 数量：至少三轮同时着地，才能保证静态稳定性。四轮可以提升稳定性，但需要适当的悬架系统。
\item 大小：越大的轮子通过性越好，但需要更大的扭矩。
\item 多数形态都有非完整约束。
\end{itemize}
%------------------------------------------------
\subsection[运动学建模]{运动学建模}
%------------------------------------------------
\subsubsection[空间描述与状态表达]{空间描述与状态表达}
%------------------------------------------------
\paragraph{坐标系}
\begin{itemize}
\item 惯性参考坐标系I：作业目标、控制指令、传感器感知测量信息。
\item 机器人参考坐标系R：控制器误差输入、控制器控制指令。
\item 笛卡尔坐标系：右手法则。
\end{itemize}
%------------------------------------------------
\paragraph{位姿（Pose）}~\\

位置空间求导得到速度空间：
$$
\xi_I = \begin{bmatrix} x_I \\ y_I \\ \theta_I \end{bmatrix}, 
\xi_R = \begin{bmatrix} x_R \\ y_R \\ \theta_R \end{bmatrix}
\overset{\text{求导}}{\Longrightarrow}
\xi_I = \begin{bmatrix} \dot{x}_I \\ \dot{y}_I \\ \dot{\theta}_I \end{bmatrix},
\xi_R = \begin{bmatrix} \dot{x}_R \\ \dot{y}_R \\ \dot{\theta}_R \end{bmatrix}
$$

惯性参考坐标系旋转得到机器人参考坐标系：
$$ \dot{\xi}_R = R\theta \dot{\xi}_I $$

旋转阵$ R(\theta) = \begin{bmatrix} \cos\theta & \sin\theta & 0 \\ -\sin\theta & \cos\theta & 0 \\ 0 & 0 & 1 \end{bmatrix} $为单位正交阵，$ R^T = R^{-1} $。
%------------------------------------------------
\subsubsection[ICR法]{ICR法\tip{ICR法运动学建模}}
\noindent
\begin{minipage}{0.3\textwidth}
\paragraph{瞬时旋转/曲率中心（ICR）}~\\
刚体上各点角速度相同。
\begin{figure}[H]
\centering 
\includegraphics[width=0.8\textwidth]{icr_point} 
\caption{瞬心}
\end{figure}
\end{minipage}
\begin{minipage}{0.7\textwidth}
\paragraph{步骤}
\begin{enumerate}
\item 坐标系变换。
\item 确定约束。
\item 计算瞬心：各轮轮轴到该点距离与速度成正比。
\item 求解$ \xi_R = \begin{bmatrix} \dot{x}_R & \dot{y}_R & \dot{\theta}_R \end{bmatrix}^T $。
\end{enumerate}
\end{minipage}
%------------------------------------------------
\subsubsection[约束方程法]{约束方程法\tip{约束方程法运动学建模}}
%------------------------------------------------
\paragraph{要求}
在水平面上运动，车轮与地面点接触，不变形，安装在钢体表面，舵机转轴与地面垂直。
%------------------------------------------------
\paragraph{约束方程}
\begin{figure}[H]
\centering
\subfloat[标准轮]{\includegraphics[width=.3\textwidth]{Standard_wheel}} \quad
\subfloat[脚轮]{\includegraphics[width=.3\textwidth]{Castor_wheel}} \quad
\subfloat[瑞典轮]{\includegraphics[width=.3\textwidth]{Swedish_wheel}}
\caption{约束方程}
\end{figure}

\begin{table}[H]
\centering
\begin{tabular}{|p{0.9cm}|p{1.3cm}|p{10cm}|p{1.4cm}|p{1.3cm}|}
\hline
类型 & 约束 & 约束方程 & 主动轮 & 随动轮 \\
\hline
\multirow{2}{*}{\parbox[c]{0.9cm}{标\\准\\轮}} & 纯滚动 & $ \begin{bmatrix} \sin(\alpha + \beta(t)) & -\cos(\alpha + \beta(t)) & -l\cos\beta(t) \end{bmatrix} R\theta \dot{\xi}_I \newline = r\dot{\varphi} $ & $ \surd $ & x \\
\cline{2-5}
& 无滑动 & $ \begin{bmatrix} \cos(\alpha + \beta(t)) & \sin(\alpha + \beta(t)) & l\sin\beta(t) \end{bmatrix} R\theta \dot{\xi}_I = 0 $ & $ \surd $ & $ \surd $ \\
\hline
\multirow{2}{*}{\parbox[c]{0.9cm}{脚\\轮}} & 纯滚动 & $ \begin{bmatrix} \sin(\alpha + \beta) & -\cos(\alpha + \beta) & -l\cos\beta \end{bmatrix} R\theta \dot{\xi}_I = r\dot{\varphi} $ & $ \surd $ & x \\
\cline{2-5}
& 无滑动 & $ \begin{bmatrix} \cos(\alpha + \beta) & \sin(\alpha + \beta) & d + l\sin\beta \end{bmatrix} R\theta \dot{\xi}_I = -d\dot{\beta} $ & $ \surd $ & x \\
\hline
\multirow{2}{*}{\parbox[c]{0.9cm}{瑞\\典\\轮}} & 纯滚动 & $ \begin{bmatrix} \cos(\alpha + \beta + \gamma) & \sin(\alpha + \beta + \gamma) & l\sin(\beta + \gamma) \end{bmatrix} R\theta \dot{\xi}_I \newline = r\dot{\varphi}\sin\gamma + r_{sw}\dot{\varphi}_{sw} $ & $ \surd $ & x \\
\cline{2-5}
& 无滑动 & $ \begin{bmatrix} \sin(\alpha + \beta + \gamma) & -\cos(\alpha + \beta + \gamma) & -l\cos(\beta + \gamma) \end{bmatrix} R\theta \dot{\xi}_I \newline = r\dot{\varphi}\cos\gamma $ & $ \surd $ \newline 小轮 & x \\
\hline
\end{tabular}
\caption{约束方程}
\end{table}
%------------------------------------------------
\paragraph{使用}
根据各轮主/随动状态列运动约束方程，得到最多三个独立约束方程（对应平面三维位姿）。

以下以$ N $标准轮（$ N_f $个固定，$ N_s $个转向）机器人为例：
\begin{itemize}
\item 滚动约束
$$ J_1(\beta_s) R(\theta) \dot{\xi}_I - J_2 \dot{\varphi} = 0 $$

其中$ J_1(\beta_s) =  \begin{bmatrix} {J_{1f}}_{(N_f \times 3)} \\ {J_{1s}(\beta_s)}_{(N_s \times 3)} \end{bmatrix}, \varphi(t) = \begin{bmatrix} \varphi_f(t) \\ \varphi_s(t) \end{bmatrix}, J_2 = diag(r_1, \cdots, r_N)\text{为轮径对角阵} $。
\item 滑动约束
$$ C_1(\beta_s) R(\theta) \dot{\xi}_I = 0 $$

其中$ C_1(\beta_s) = \begin{bmatrix} {C_{1f}}_{(N_f \times 3)} \\ {C_{1s}(\beta_s)}_{(N_s \times 3)} \end{bmatrix} $。
\end{itemize}
%------------------------------------------------
\subsubsection[例子]{例子}\label{sec:example1}
以下以两轮差速机器人（见\ref{sec:two_wheel}）为例，$ \alpha = \frac{\pi}{2}, \beta = 0 $：
\begin{figure}[H]
\centering
\subfloat[ICR法]{\includegraphics[width=.35\textwidth]{icr}} \quad
\subfloat[约束方程法]{\includegraphics[width=.4\textwidth]{Equation_of_motion}}
\caption{两轮差速机器人正运动学建模}
\end{figure}
%------------------------------------------------
\paragraph{ICR法}~\\

两轮差速机器人的瞬心在两轮轮轴上，设其到机器人两轮中间的距离为$ R $，有：
$$ \dot{\theta} = \frac{\dot{x}_R}{R} = \frac{\dot{\varphi}_l r}{R-l} = \frac{\dot{\varphi}_r r}{R+l} $$

解得$ R = \frac{\dot{\varphi}_r + \dot{\varphi}_l}{\dot{\varphi}_r - \dot{\varphi}_l} $，代回即可。
%------------------------------------------------
\paragraph{约束方程法}
\begin{itemize}
\item 纯滚动：$ \begin{bmatrix} \sin(\alpha + \beta) & -\cos(\alpha + \beta) & -l\cos\beta \end{bmatrix} \dot{\xi}_R = r\dot{\varphi} $。
\item 无滑动：$ \begin{bmatrix} \cos(\alpha + \beta) & \sin(\alpha + \beta) & l\sin\beta \end{bmatrix} \dot{\xi}_R = 0 $。
\end{itemize}
%------------------------------------------------
\paragraph{正运动学模型}
$$ \dot{\xi}_R = \begin{bmatrix} \dot{x}_R \\ \dot{y}_R \\ \dot{\theta}_R \end{bmatrix} = \frac{r}{2} \begin{bmatrix} \dot{\varphi}_l + \dot{\varphi}_r \\ 0 \\ \frac{\dot{\varphi}_r - \dot{\varphi}_l}{l} \end{bmatrix} $$
%------------------------------------------------
\subsection[自由度]{自由度}
%------------------------------------------------
\paragraph{概念}
\begin{itemize}
\item 衡量机器人改变运行状态的能力。
\item 需满足实际作业需求，考虑实现成本。
\item 机器人设计基础、算法依据（一般同自由度机器人可采用相同控制规划算法）。
\item 平面运动机器人自由度最大不能超过$ 3 $。
\end{itemize}
%------------------------------------------------
\paragraph{分类}\tip{自由度分类}
\begin{itemize}
\item 移动度（Degree of Mobility）$ \delta_m $：瞬时改变机器人运动状态的能力。
$$ \delta_m = \dim[C_1(\beta_s)] = 3 - \operatorname{rank}[C_1(\beta_s)] \in [0,3] $$
\item 转向度（Degree of Steerability）$ \delta_s $：间接改变机器人运动状态的能力。
$$ \delta_s = \operatorname{rank}[C_{1s}(\beta_s)] \in [0,2] $$
\item 机动度（Degree of Maneuverability）$ \delta_M $：改变机器人运动状态的能力。
$$ \delta_M = \delta_m + \delta_s $$
\begin{itemize}
\item 机动度相同，结构不一定相同。
\item $ \delta_M = 2 $，瞬心位于一条直线上；$ \delta_M = 3 $，瞬心可分布于空间任何一点。
\end{itemize}
\end{itemize}
%------------------------------------------------
\paragraph{实例}
\begin{itemize}
\item 全向机器人：
\begin{itemize}
\item Type(3,0)：完整约束全方位移动机器人。
\item Type(2,1)：一个同心轮+两个瑞典轮。
\item Type(1,2)：多舵机全方位移动机器人。
\end{itemize}
\item 非全向机器人：
\begin{itemize}
\item Type(2,0)：差分移动机器人。
\item Type(1,1)：自动驾驶汽车（阿克曼转向）、自行车、叉车。
\end{itemize}
\end{itemize}
%----------------------------------------------------------------------------------------
\section{机器人运动控制（控制器思想）}
%------------------------------------------------
\subsection[运动控制]{运动控制}\label{sec:motion_control}
\begin{figure}[H]
\centering 
\includegraphics[width=0.8\textwidth]{controller} 
\caption{运动控制器}
\end{figure}

误差（惯性系下给定与反馈）$ \overset{\text{变换}}{\Longrightarrow} $输入（机器人系下控制输入）。 
%------------------------------------------------
\paragraph{特点}
\begin{itemize}
\item 大多存在滑动约束，是非完整系统，有侧向偏差和姿态偏差。
\item 非线性，控制器设计复杂，还需要根据可获得的反馈信号选取，按顺序调节控制参数，并且不能同时实现定点控制和跟踪控制。
\item 不存在能完成控制目标的连续时不变（静态）反馈控制率。
\item 受标定精度影响大，且由于执行单元性能约束，控制输入要合理限幅。
\end{itemize}
%------------------------------------------------
\paragraph{分类}
\begin{itemize}
\item 定点（镇定）控制（Regulation Control）：以指定姿态到达指定位置。
\item 跟踪控制：
\begin{itemize}
\item 轨迹跟踪控制（Trajectory Tracking Control）：跟随给定轨迹（包含速度、姿态信息）。
\item 路径跟踪控制（Path Tracking Control）：跟随给定路线。
\end{itemize}
\end{itemize}
%------------------------------------------------
\paragraph{开环控制}
将运动轨迹分割成直线和圆弧，存在以下问题：
\begin{itemize}
\item 直线和圆弧的曲率不一致，不连续。
\item 难以实现定义若干合适轨迹。
\item 速度加速度约束。
\item 无法自适应调整轨迹来面对环境变化。
\item 所得轨迹不光滑。
\end{itemize}
%------------------------------------------------
\paragraph{控制器性能评价}
取正定李雅普诺夫函数，其导数负定则系统渐进稳定。
%------------------------------------------------
\paragraph{两轮差速机器人运动控制}
以下以两轮差速机器人（见\ref{sec:two_wheel}）为例。
$$ 
\dot{\xi}_R = \begin{bmatrix} \dot{x}_R \\ \dot{y}_R \\ \dot{\theta}_R \end{bmatrix} = \frac{r}{2} \begin{bmatrix} \dot{\varphi}_l + \dot{\varphi}_r \\ 0 \\ \frac{\dot{\varphi}_r-\dot{\varphi}_l}{l} \end{bmatrix} = \begin{bmatrix} v_1 \\ 0 \\ v_2 \end{bmatrix} 
\overset{\text{变换}}{\Longrightarrow}
\dot{\xi}_I = \begin{bmatrix} \dot{x}_I \\ \dot{y}_I \\ \dot{\theta}_I \end{bmatrix} = \begin{bmatrix} \cos\theta & 0 \\ \sin\theta & 0 \\ 0 & 1 \end{bmatrix} \begin{bmatrix} v_1 \\ v_2 \end{bmatrix} 
$$
%------------------------------------------------
\subsection[定点控制器]{定点控制器\tip{定点控制器}}
%------------------------------------------------
\paragraph{控制目标}
机器人参考坐标系下误差$ e = \begin{bmatrix} x & y & \theta \end{bmatrix}^T $，设计控制阵$ K = \begin{bmatrix} k_{11} & k_{12} & k_{13} \\ k_{21} & k_{22} & k_{23} \end{bmatrix} $，其中$ k_{ij} = k(t, e) $，得到控制输入$ \begin{bmatrix} v(t) \\ \omega(t) \end{bmatrix} = Ke $，使$ \lim_{t \to \infty} e(t) = 0 $。
%------------------------------------------------
\paragraph{误差信号转换}~\\

惯性系下，实际状态$ q = \begin{bmatrix} x & y & \theta \end{bmatrix}^T $与参考状态$ q_r \begin{bmatrix} x_r & y_r & \theta_r \end{bmatrix}^T $之差为开环误差$ \tilde{q} = \begin{bmatrix} \tilde{x} & \tilde{y} & \tilde{\theta} \end{bmatrix}^T = \begin{bmatrix} x - x_r & y - y_r & \theta - \theta_r \end{bmatrix}^T $。
\begin{enumerate}
\item 转换到机器人系
$$ 
e = \begin{bmatrix} e_1 \\ e_2 \\ e_3 \end{bmatrix} = R(\theta)^T \tilde{q} = \begin{bmatrix} \cos\theta & \sin\theta & 0 \\ -\sin\theta & \cos\theta & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \tilde{x} \\ \tilde{y} \\ \tilde{\theta} \end{bmatrix}
\overset{\text{闭环}}{\Longrightarrow}
\dot{e} = \begin{bmatrix} \dot{e}_1 \\ \dot{e}_2 \\ \dot{e}_3 \end{bmatrix} = R(\theta)\dot{\tilde{q}} + \dot{R(\theta)}\tilde{q} = \begin{bmatrix} v_1 + v_2 e_2 \\ -v_2 e_1 \\ v_2 \end{bmatrix} 
$$
\item 转换到极坐标系
$$ 
\begin{cases}
\rho &= \sqrt{\tilde{x}^2 + \tilde{y}^2} \\
\beta &= -\arctan2(-\tilde{y},-\tilde{x}) \\
\alpha &= -\beta - \tilde{\theta} \\
\end{cases}
\overset{\text{闭环}}{\Longrightarrow}
\begin{bmatrix} \dot{\rho} \\ \dot{\beta} \\ \dot{\alpha} \end{bmatrix} = 
\begin{bmatrix} -\cos\alpha & 0 \\ \frac{\sin\alpha}{\rho} & 0 \\ \frac{\sin\alpha}{\rho} & -1 \end{bmatrix}
\begin{bmatrix} v_1 \\ v_2 \end{bmatrix}
$$ 
\end{enumerate}
%------------------------------------------------
\paragraph{机器人系非线性控制器}~\\

设计控制器$ \begin{bmatrix} v_1 \\ v_2 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 \\ -k_2 e_2 + e_2^2 \sin(t) \end{bmatrix} $，代入得$ \begin{bmatrix} \dot{e}_1 \\ \dot{e}_2 \\ \dot{e}_3 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 + v_2 e_2 \\ -v_2 e_1 \\ -k_2 e_2 + e_2^2 \sin(t) \end{bmatrix} $，其有误差时扰动，效果不佳。
%------------------------------------------------
\paragraph{极坐标系线性控制器}~\\

设计控制器%
$ 
\begin{cases}
v_1 &= k_\rho \rho \\
v_2 &= k_\alpha \alpha + k_\beta \beta
\end{cases}
$，%
代入得
$$ 
\begin{bmatrix} \dot{\rho} \\ \dot{\beta} \\ \dot{\alpha} \end{bmatrix} 
= \begin{bmatrix} -k_\rho \rho \cos\alpha \\ -k_\rho \sin\alpha \\ k_\rho \sin\alpha - k_\alpha \alpha - k_\beta \beta \end{bmatrix} 
\overset{\alpha \to 0}{\Longrightarrow}
\begin{bmatrix} -k_\rho \rho \\ -k_\rho \alpha \\ k_\rho \alpha - k_\alpha \alpha - k_\beta \beta \end{bmatrix} 
$$

其中前两行非线性耦合，在$ \alpha \to 0 $时指数性稳定，非全局稳定。
%------------------------------------------------
\paragraph{极坐标系线性控制器}~\\

设计控制器%
$
\begin{cases}
v_1 &= k_\rho \rho \cos\alpha \\
v_2 &= k_\alpha \alpha + \frac{k_\rho \sin \alpha \cos\alpha}{\alpha}(\alpha - k_\beta\beta)
\end{cases}
$，%
代入得
$$ 
\begin{bmatrix} \dot{\rho} \\ \dot{\beta} \\ \dot{\alpha} \end{bmatrix} 
= \begin{bmatrix} -k_\rho \rho \cos^2\alpha \\ -k_\rho \cos\alpha \sin\alpha \\ k_\rho \cos\alpha \sin\alpha - k_\alpha \alpha - \frac{k_\rho \sin\alpha \cos\alpha}{\alpha} (\alpha - k_\beta\beta) \end{bmatrix} 
\overset{\alpha \to 0}{\Longrightarrow}
\begin{bmatrix} -k_\rho \rho \\ -k_\rho \alpha \\ - k_\alpha \alpha + k_\rho k_\beta\beta \end{bmatrix} 
$$

其全局渐近稳定。
%------------------------------------------------
\subsection[轨迹跟踪控制器]{轨迹跟踪控制器\tip{轨迹跟踪控制器}}
%------------------------------------------------
\paragraph{控制目标与误差变换}~\\

惯性系下，实际轨迹$ q(t) = \begin{bmatrix} x(t) & y(t) & \theta(t) \end{bmatrix}^T $与参考轨迹$ q_r \begin{bmatrix} x_r(t) & y_r(t) & \theta_r(t) \end{bmatrix}^T $之差为开环误差$ \tilde{q}(t) = \begin{bmatrix} \tilde{x}(t) & \tilde{y}(t) & \tilde{\theta}(t) \end{bmatrix}^T = \begin{bmatrix} x(t) - x_r(t) & y(t) - y_r(t) & \theta(t) - \theta_r(t) \end{bmatrix}^T $，控制目标为$ \lim_{n \to \infty} \tilde{q}(t) = 0 $。

开环误差转换坐标系后求闭环误差，进而得到辅助误差信号：
$$ 
e = \begin{bmatrix} \cos\theta & \sin\theta & 0 \\ -\sin\theta & \cos\theta & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \tilde{x} \\ \tilde{y} \\ \tilde{\theta} \end{bmatrix}
\overset{\text{闭环}}{\Longrightarrow}
\dot{e} = \begin{bmatrix} v_1 + v_2 e_2 - v_{1r} \cos e_3 \\ - v_2 e_1 + v_{1r} \sin e_3 \\ v_2 - v_{2r} \end{bmatrix} 
$$
%------------------------------------------------
\paragraph{控制器}~\\

设计控制器$ \begin{bmatrix} v_1 \\ v_2 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 + v_{1r} \cos e_3 \\ -v_{1r} \frac{\sin e_3}{e_3} e_2 - k_2 e_3 + v_{2r} \end{bmatrix} $，代入得$ \begin{bmatrix} \dot{e}_1 \\ \dot{e}_2 \\ \dot{e}_3 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 + v_2 e_2 \\ -v_2 e_1 + v_{1r} \sin e_3 \\ -k_2 e_3 - v_{1r} \frac{\sin e_3}{e_3} e_2 \end{bmatrix} $。

$ e_3 \to 0 $时，控制器简化为$ \begin{bmatrix} v_1 \\ v_2 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 + v_{r1} \\ -v_{r1}  e_2 + v_{r2} \end{bmatrix} $，代入得$ \begin{bmatrix} \dot{e}_1 \\ \dot{e}_2 \\ \dot{e}_3 \end{bmatrix} = \begin{bmatrix} -k_1 e_1 + v_2 e_2 \\ -v_2 e_1 \\ -k_2 e_3 - v_{r1} e_2 \end{bmatrix} $。
%------------------------------------------------
\subsection[路径跟踪控制器]{路径跟踪控制器\tip{路径跟踪控制器}}
%------------------------------------------------
\paragraph{控制目标与误差变换}~\\

惯性系下，实际路径$ q(s) = \begin{bmatrix} x(s) & y(s) & \theta(s) \end{bmatrix}^T $与参考路径$ q_r \begin{bmatrix} x_r(s) & y_r(s) & \theta_r(s) \end{bmatrix}^T $之差为开环误差$ \tilde{q}(s) = \begin{bmatrix} \tilde{x}(s) & \tilde{y}(s) & \tilde{\theta}(s) \end{bmatrix}^T = \begin{bmatrix} x(s) - x_r(s) & y(s) - y_r(s) & \theta(s) - \theta_r(s) \end{bmatrix}^T $，其中$ s \in [0,1] $为路径参考变量，控制目标为$ \lim_{n \to \infty} \tilde{q}(s) = 0 $。

作变换%
$
\begin{cases}
y_1 &= x + b\cos\theta \\
y_2 &= y + b\sin\theta
\end{cases}
$，%
进而得到闭环误差$ \begin{bmatrix} \dot{y}_1 \\ \dot{y}_2 \end{bmatrix} = \begin{bmatrix} \cos\theta & -b\sin\theta \\ \sin\theta & b\cos\theta \end{bmatrix} \begin{bmatrix} v \\ \omega \end{bmatrix} = T(\theta) \begin{bmatrix} v \\ \omega \end{bmatrix} $。

逆运算得到$ \begin{bmatrix} v \\ \omega \end{bmatrix} = T^{-1}(\theta) \begin{bmatrix} u_1 \\ u_2 \end{bmatrix} = \begin{bmatrix} \cos\theta & \sin\theta \\ -\frac{\sin\theta}{b} & \frac{\cos\theta}{b} \end{bmatrix} \begin{bmatrix} u_1 \\ u_2 \end{bmatrix} $，故%
$
\begin{cases}
\dot{y}_1 &= u_1 \\
\dot{y}_2 &= u_2 \\
\dot{\theta} &= \frac{u_2 \cos\theta - u_1 \sin\theta}{b}
\end{cases}
$。
%------------------------------------------------
\paragraph{控制器}~\\

设计控制器
$ 
\begin{cases}
u_1 = \dot{y}_{1d} + k_1(y_{1d} - y_1) \\
u_2 = \dot{y}_{2d} + k_2(y_{2d} - y_2)
\end{cases} 
$%
，有%
$
\begin{cases}
\dot{\tilde{y}}_1 = -k_1\tilde{y}_1 \\
\dot{\tilde{y}}_2 = -k_2\tilde{y}_2
\end{cases}
$%
，系统指数性收敛。
%----------------------------------------------------------------------------------------
\section{机器人感知与定位建图}
%------------------------------------------------
\subsection[传感器]{传感器}
%------------------------------------------------
\paragraph{常见传感器}
激光雷达（Laser）、里程计（Odometer）、声纳（Rader）、摄像机（Camera）、惯导系统（IMU）、加速度传感器（Accelerometer）、陀螺（Gyroscope）、力觉传感器（Force Sensor）、罗盘（Compass）。
%------------------------------------------------
\paragraph{分类}
\begin{itemize}
\item PC（Proprioceptive，本体感受）/EC（Exteroceptive，外感受）。
\item A（Active，有源）/P（Passive，无源）。
\end{itemize}
%------------------------------------------------
\paragraph{特性}
\begin{itemize}
\item 测量范围：测量上下界之差。    
\item 动态范围：测量范围上下界比率，常用对数表示，单位为$ dB $。
\item 分辨率：最小可测量变化量，一般为为动态范围下界。
\item 线性度：输入输出信号的映射关系。
\end{itemize}
%------------------------------------------------
\subsection[光电传感器]{光电传感器}
把被测量变化转换成光信号变化，再转换成电信号。
%------------------------------------------------
\subsubsection[概述]{概述}
%------------------------------------------------
\paragraph{组成}
辐射源、光学通路、光电器件。
%------------------------------------------------
\paragraph{特性}
\begin{itemize}
\item 不受电磁干扰影响。
\item 非接触测量。
\item 频谱宽，高精度，高分辨率，高可靠性，发应快。
\end{itemize}
%------------------------------------------------
\subsubsection[编码器]{编码器\tip{编码器}}
测量系统相对运动角度，具有高精度、高分辨率和高可靠性。按结构可分为接触式、光电式和电磁式，后两种为非接触式编码。
%------------------------------------------------
\paragraph{增量式旋转编码器}
\begin{itemize}
\item 不能直接输出数字编码，需要增数字电路。
\item 原理：遮光周期性变化，莫尔条纹明暗交替，电压周期性变化$ U_0 = U_m \cos(\frac{2\pi}{W}x) $，形成脉冲，根据脉冲数量可推算旋转角度，位置数据是相对的。
\item 辨向：为判断光栅移动方向，使用D触发器（）整合两个光栅的信息。
\begin{itemize}
\item D触发器：时钟信号有效时，$ Q = D $。
\item 边缘D触发器：时钟信号处于有效边沿时，$ Q = D $。
\end{itemize}
\end{itemize}
%------------------------------------------------
\paragraph{绝对式光电编码器}
\begin{itemize}
\item 能直接输出某种码制的数码。
\item 格雷码（余$ 3 $循环码）：任意相邻数只有一位二进制数不同，可以由二进制码按位异或（第一位保留）获得，属于可靠性编码，求反方便。
\end{itemize}
%------------------------------------------------
\subsection[里程计]{里程计}
%------------------------------------------------
\subsubsection[里程计模型]{里程计模型\tip{里程计模型}}\label{sec:odometer}
%------------------------------------------------
\paragraph{两轮差速机器人里程计模型}
以下以两轮差速机器人（见\ref{sec:two_wheel}）为例。
$$ 
\dot{\xi}_R = \begin{bmatrix} \dot{x}_R \\ \dot{y}_R \\ \dot{\theta}_R \end{bmatrix} = \frac{r}{2} \begin{bmatrix} \dot{\varphi}_l + \dot{\varphi}_r \\ 0 \\ \frac{\dot{\varphi}_r-\dot{\varphi}_l}{l} \end{bmatrix} = \begin{bmatrix} v \\ 0 \\ \omega \end{bmatrix} 
\overset{\text{转换到惯性系}}{\Longrightarrow}
\begin{cases}
\dot{x} &= v \cos \theta \\
\dot{y} &= v \sin \theta \\
\dot{\theta} &= \omega   
\end{cases}
$$

码盘读数为：
$$ 
\begin{cases}
\Delta s = \frac{r}{2}(\Delta \phi_R + \Delta \phi_L) \\
\Delta \theta = \frac{r}{2d}(\Delta \phi_R - \Delta \phi_L)
\end{cases}
\overset{\text{小时间变化}}{\Longrightarrow}
\begin{cases}
\Delta s &= v_k T_s \\
\Delta \theta &= \omega_k T_s    
\end{cases}   
$$ 
%------------------------------------------------
\paragraph{建模方法}
\begin{figure}[H]
\centering
\subfloat[欧拉法]{\includegraphics[width=.3\textwidth]{euler}} \quad
\subfloat[二阶Runge-Kutta法]{\includegraphics[width=.3\textwidth]{rk2}} \quad
\subfloat[解析积分法]{\includegraphics[width=.3\textwidth]{exact}}
\caption{里程计建模方法}
\end{figure}

\begin{itemize}
\item 欧拉法
$$
\begin{cases}
x_{k + 1} = x_k + v_k T_s \cos \theta_k \\
y_{k + 1} = y_k + v_k T_s \sin \theta_k \\
\theta_{k + 1} = \theta_k + \omega_k T_s
\end{cases}   
$$
\item 二阶Runge-Kutta法
$$
\begin{cases}
x_{k + 1} = x_k + v_k T_s \cos(\theta_k + \frac{\omega_k T_s}{2}) \\
y_{k + 1} = y_k + v_k T_s \sin(\theta_k + \frac{\omega_k T_s}{2}) \\
\theta_{k + 1} = \theta_k + \omega_k T_s
\end{cases}  
$$
\item 解析积分法
$$
\begin{cases}
x_{k + 1} = x_k + \frac{v_k}{\omega_k} (\sin \theta_{k + 1} - \sin \theta_k) \\
y_{k + 1} = y_k - \frac{v_k}{\omega_k} (\cos \theta_{k + 1} - \cos \theta_k) \\
\theta_{k + 1} = \theta_k + \omega_k T_s
\end{cases} 
\overset{\omega_k = 0}{\Longrightarrow}
\begin{cases}
x_{k + 1} = x_k + v_k T_s \\
y_{k + 1} = y_k \\
\end{cases}  
$$
\end{itemize}
%------------------------------------------------
\subsubsection[里程计误差]{里程计误差}
%------------------------------------------------
\paragraph{误差来源}
\begin{itemize}
\item 数值积分误差。
\item 运动学参数误差：速度不恒定，半径误差。
\item 打滑。
\end{itemize}
%------------------------------------------------
\paragraph{误差传播}\tip{误差传播}\label{sec:error back}~\\

二阶Runge-Kutta法的位姿更新为：
$$
p' = f(x, y, \theta, \Delta\phi_R, \Delta\phi_L) = 
\begin{bmatrix} x \\ y \\ \theta \end{bmatrix} + 
\begin{bmatrix} \frac{r(\Delta\phi_R + \Delta\phi_L)}{2} \cos(\theta_k + \frac{r[\Delta\phi_R - \Delta\phi_L]}{4d}) \\ \frac{r(\Delta\phi_R + \Delta\phi_L)}{2} \sin(\theta_k + \frac{r[\Delta\phi_R - \Delta\phi_L]}{4d}) \\ \frac{r(\Delta\phi_R - \Delta\phi_L)}{2d} \end{bmatrix}
$$

其中$ \Delta\phi_R,\Delta\phi_L $是控制输入量，有误差协方差矩阵迭代公式：
$$ \sum_{p'} = \underbrace{\nabla_p f \cdot \sum_p \cdot \nabla_p f^T}_{\text{位姿}} + \underbrace{\nabla_{r|l}f \cdot \sum_{\Delta} \cdot \nabla_{r|l}f^T}_{\text{控制输入量}} $$

初始化姿态协方差矩阵$ \sum_{p'} $（可零初始化），其更新量为：
$$
\nabla_p f = \begin{bmatrix}\frac{\partial f}{\partial x} & \frac{\partial f}{\partial y} & \frac{\partial f}{\partial \theta}\end{bmatrix} = 
\begin{bmatrix} 1 & 0 & -\Delta s \sin(\theta_k + \frac{\Delta\theta}{2}) \\ 0 & 1 & \Delta s \cos(\theta_k + \frac{\Delta\theta}{2}) \\ 0 & 0 & 1 \end{bmatrix}
$$

假设$ \Delta\phi_R,\Delta\phi_L $的误差相互独立，有控制输入量协方差矩阵：
$$ \sum_{\Delta} = covar(\Delta\phi_R, \Delta\phi_L) = \begin{bmatrix} k_r||\Delta\phi_R|| & 0 \\ 0 & k_l||\Delta\phi_L|| \end{bmatrix} $$

其更新量为：
$$ \nabla_{rl}f = \begin{bmatrix} \frac{\partial f}{\partial \Delta\phi_R} & \frac{\partial f}{\partial \Delta\phi_L} \end{bmatrix} = \begin{bmatrix} \frac{r}{2}\cos(\theta_k + \frac{\Delta\theta}{2}) - \frac{r}{4d}\Delta s \sin(\theta_k + \frac{\Delta\theta}{2}) & \frac{r}{2}\cos(\theta_k + \frac{\Delta\theta}{2}) + \frac{r}{4d}\Delta s \sin(\theta_k + \frac{\Delta\theta}{2}) \\ \frac{r}{2}\sin(\theta_k + \frac{\Delta\theta}{2}) + \frac{r}{4d}\Delta s \cos(\theta_k + \frac{\Delta\theta}{2}) & \frac{r}{2}\sin(\theta_k + \frac{\Delta\theta}{2}) - \frac{r}{4d}\Delta s \cos(\theta_k + \frac{\Delta\theta}{2}) \\ \frac{r}{2d} & -\frac{r}{2d} \end{bmatrix} $$
%------------------------------------------------
\paragraph{误差转化展示}
原理见\ref{sec:error}。

\begin{figure}[H]
\centering
\subfloat[直线运动]{\includegraphics[width=.3\textwidth]{line}} \quad
\subfloat[曲线运动]{\includegraphics[width=.3\textwidth]{circle}}
\caption{里程计误差转化展示}
\end{figure}

直线运动时误差方向与运动方向垂直，曲线运动时则不垂直。
%------------------------------------------------
\subsection[激光传感器]{激光传感器}
%------------------------------------------------
\subsection[点云匹配与定位]{点云匹配与定位}
%------------------------------------------------
\subsection[卡尔曼滤波]{卡尔曼滤波}
%------------------------------------------------
\subsection[蒙特卡洛定位]{蒙特卡洛定位}
%------------------------------------------------
\subsection[SLAM]{SLAM}
%----------------------------------------------------------------------------------------
\section{机器人轨迹规划}
%----------------------------------------------------------------------------------------
\section{附录}
%------------------------------------------------
\subsection[误差转化展示]{误差转化展示}\label{sec:error}
将误差传播协方差矩阵$ \sum_p $转化成椭圆展示。
%------------------------------------------------
\paragraph{计算}
取$ \sum_p $左上二阶子阵$ \sum_{p_{xy}} = \begin{bmatrix} \sigma_{xx} & \sigma_{xy} \\ \sigma_{xy} & \sigma_{yy} \end{bmatrix} $，计算特征值$ \lambda_1,\lambda_2 $和特征向量$ \overrightarrow{p}_1,\overrightarrow{p}_2 $，其分别表示长短轴的大小和方向，圆心是$ (x_k, y_k) $（直接对$ \sum_p $求取特征根和特征向量，再取前两个，结果与其不同）。
%------------------------------------------------
\paragraph{意义}
\begin{itemize}
\item 长短轴表示误差在不同方向上的大小，可通过开根号、乘系数等方法调节。
\item 方向角表示误差传播的主要方向，体现了误差传播的各向异性。
\item 椭圆大小反映了系统的误差范围，可按置信度缩放。
\end{itemize}

返回里程计\ref{sec:error back}
%----------------------------------------------------------------------------------------
\end{document}